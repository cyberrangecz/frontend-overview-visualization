<div class="overview-visualization-container">

  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

    <ng-container [matColumnDef]="column" *ngFor="let column of displayedColumns">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> {{column}} </th>
      <td mat-cell *matCellDef="let element"> {{element[column]}} </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>


  <div>
    <div>
      <table mat-table class="table table-striped table-bordered table-condensed">
          <thead>
            <tr>
              <th style="cursor:pointer" (click)="onPlayerClick()" (mouseover)="columnHovered = -1" (mouseout)="columnHovered = null">Player
                <ng-container *ngIf="sortedColumn === -1 || columnHovered === -1">
                  <span *ngIf="sortedDesc"  >
                    ▼
                  </span>
                  <span *ngIf="!sortedDesc">
                    ▲
                  </span>
                </ng-container>
              </th>
              <ng-container *ngFor="let level of scoreTableData.levels; let i = index">
                <th mat-header-cell>
                  <span style="cursor:pointer" (click)="onLevelClick(i)" (mouseover)="columnHovered = i" (mouseout)="columnHovered = null">
                    Level {{ i + 1}}
                  </span> <br>
                  <span style="font-size: 10px; cursor:pointer" (click)="onLevelClick(i)" (mouseover)="columnHovered = i" (mouseout)="columnHovered = null">
                    Score
                    <ng-container *ngIf="sortedColumn === i || columnHovered === i">
                        <span *ngIf="sortedDesc">
                          ▼
                        </span>
                        <span *ngIf="!sortedDesc">
                          ▲
                        </span>
                      </ng-container>
                  </span>
                  <ng-container *ngIf="filters.hintFilter.checked || filters.wrongFlagFilter.checked">
                    <span style="font-size: 10px; cursor:pointer" *ngIf="filters.wrongFlagFilter.checked" (click)="onWrongClick(i)"
                    (mouseover)="columnHovered = 'w'+i" (mouseout)="columnHovered = null"> / Wrong
                        <ng-container *ngIf="sortedColumn === 'w'+i  || columnHovered === 'w'+i">
                            <span *ngIf="sortedDesc">
                              ▼
                            </span>
                            <span *ngIf="!sortedDesc">
                              ▲
                            </span>
                          </ng-container>
                    </span>
                    <span style="font-size: 10px; cursor:pointer" *ngIf="filters.hintFilter.checked" (click)="onHintsClick(i)"
                    (mouseover)="columnHovered = 'h'+i" (mouseout)="columnHovered = null"> / Hint
                        <ng-container *ngIf="sortedColumn === 'h'+i  || columnHovered === 'h'+i">
                            <span *ngIf="sortedDesc">
                              ▼
                            </span>
                            <span *ngIf="!sortedDesc">
                              ▲
                            </span>
                          </ng-container>
                    </span>
                  </ng-container>
                </th>
              </ng-container>
              <th style="cursor:pointer" (click)="onFinalClick()" (mouseover)="columnHovered = -2" (mouseout)="columnHovered = null">Final<br>
                <span style="font-size: 10px;"> Score
                    <ng-container *ngIf="sortedColumn === -2  || columnHovered === -2">
                        <span *ngIf="sortedDesc">
                          ▼
                        </span>
                        <span *ngIf="!sortedDesc">
                          ▲
                        </span>
                      </ng-container>
                </span>
              </th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let player of playersOrdered">
              <tr *ngIf="player"
                style="cursor:pointer"
                (click)="onRowClick(player)"
                (mouseover)="onRowMouseover(player)"
                (mouseout)="onRowMouseout(player)"
                [ngClass]="{'checked' : player.checked}"
                >
                <td>
                  <div *ngIf="player.checked" class="row-stripe" [ngStyle]="{'background': playerColorScale(player.id.toString())}">
                  </div>
                  <span [ngStyle]="{'font-weight': player.id === feedbackLearnerId ? 'bold' : 'normal'}">{{
                    (feedbackLearnerId === undefined || feedbackLearnerId === null) ? player.id : (
                      feedbackLearnerId === player.id ? 'your results' : 'other player'
                    )
                  }}</span>
                  <input style="display:none;" type="checkbox" name="player" [id]="player.id" [(ngModel)]="player.checked">
                </td>
                <ng-container *ngFor="let level of scoreTableData.levels">
                  <td>
                    <ng-container *ngIf="level[player.id]">
                        {{ level[player.id].score }}
                        <span *ngIf="filters.wrongFlagFilter.checked">
                          / {{ level[player.id].wrongFlags }}
                        </span>
                        <span *ngIf="filters.hintFilter.checked">
                            / {{ level[player.id].hints }}
                        </span>
                    </ng-container>
                    <span *ngIf="!level[player.id]">
                      -
                    </span>
                  </td>
                </ng-container>
                <td>{{ scoreTableData.finalScores[player.id] }}</td>
              </tr>
            </ng-container>
          </tbody>
        </table>
    </div>
  </div>
</div>
